---
layout: article
---

# {{ page.title }}

---

**index**
1. 구축환경
2. 패키지 설치
3. 레지스트리 다운로드
4. 이미지 실행
5. Web Station 설정
6. DNS 설정

---

## 1. 구축환경

DSM 버전: DSM 7.2-64570 Update 1

모델 이름: DS220+

## 2. 패키지 설치

2.1. NAS > 메인메뉴 > 패키지 센터 > 모든 패키지 > 검색: Container Manager > 설치  

2.2. NAS > 메인메뉴 > 패키지 센터 > 모든 패키지 > 검색: Web Station > 설치

## 3. 레지스트리 다운로드

3.1. NAS > Container Manager 실행 > 레지스트리 > 검색: nginx > 다운로드 > 태그: latest

## 4. 이미지 실행

4.1. NAS > Container Manager 실행 > 이미지 > nginx > 실행

4.2. 일반설정
- 이미지 : nginx:latest
- 컨테이너 이름 : {container name}
- 리소스 제한 활성화 : null
- 자동 재시작 활성화 : null
- Web Station을 통해 웹 포털 설정
  - 컨테이너 포트: 80 - HTTP

4.3. 고급설정
- 포트설정 : Web Station의 경우 - 80 - HTTP
- 볼륨설정(+폴더추가) : /docker/{folder name} - {folder name} - 읽기/쓰기
- 환경
    - PATH : /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
    - NGINX_VERSION : 1.25.1
    - NJS_VERSION : 0.7.12
    - PKG_RELEASE : 1~bookworm
- 기능
    - 기능 구성 : 기본설정
- 네트워크
    - 네트워크 : bridge

## 5. Web Station 설정

5.1. NAS > Web Station 실행 > 웹 포털 > 포털 만들기 마법사 > 웹 서비스 포털 설정
- 서비스 : {container name}
- 포털 유형 : 이름 기반
- 호스트 이름 : {domain name (ex.blog.kkmproject.com)}
- 포트 : 80/443
- HTTPS 설정: check

5.2. 연결 테스트 : https://{domain name}

## 6. DNS 설정

6.1. 가비아 > My가비아 > DNS 관리툴 > 가비아 등록 도메인 > DNS 관리 > 도메인 선택 > DNS 설정 > 레코드 추가
- 타입 : A
- 호스트 : nas
- 값/위치 : {공인IP}
- TTL : 1800

## 7. ngnix 설정

7.1. NAS > Container Manager > 컴테이너 > {container name} > 터미널 열기 > 생성

7.2. SSH 접속
*해당 과정 이후 아래 터미널은 모두 해당 접속 기반으로 이루어집니다.*
```bash
$ ssh -p {nas dsm port} {nas id}@{nas ip}
$ docker ps -all
$ docker exec -itu 0 {container name} /bin/bash

# help
# service nginx status    : nginx 상태 확인
# service nginx restart  : nginx 재실행
# service nginx reload    : nginx 재실행(미중지)
# service nginx stop      : nginx 중지


$ service nginx status
nginx is running.

```

7.2. 자바설치
```bash
$ apt-get update
$ apt-get upgrade
$ apt-get install openjdk-17-jdk
```

7.3 vim 설치
```html
$ apt-get vim
```

7.3. reverse proxy 설정
```bash
# if OS is Cent ? /etc/nginx/conf.d
# if OS is Ubuntu/Debian ? /etc/nginx/site-available
$ cd /etc/nginx/conf.d
$ vi default.conf

# ...
  location / {
    proxy_pass http://localhost:8080
    # ...
  }
# ...

```

7.4. 연결테스트
연결 테스트 : https://{domain name}